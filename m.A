bits 64
%macro function 1
  %defstr %%name %1
  mov rax, rdi
  mov rdi, %%name
  lea rsi, [rel %1]
  lea rdx, [rel %1.end]
  jmp rax
%1:
%endmacro
%macro return 0
  ret
  .end:
%endmacro

%macro import 2
%%next:
  lea   rdi, [rel %%pith]
  jmp   rdx 
%1:
  dq 0
%%pith:
  mov   rax, %2
  cmp   rdi, rax
  jne    %%next
  mov  [rel %1], rsi
%endmacro

%macro imports 1-*
%rep (%0)
  %defstr %%name %1
  import %1, %%name
  %rotate  1
%endrep
%endmacro
