bits 64
%macro function 1
  %defstr %%name %1
  mov rax, rdi
  mov rdi, %%name
  lea rsi, [rel %1]
  lea rdx, [rel %1.end]
  jmp rax
%1:
%endmacro
%macro return 0
  ret
  .end:
%endmacro

%macro import 1
%defstr %%name %1
%%next:
  lea   rdi, [rel %%loop]
  jmp   rdx 
%1:
  dq 0
%%loop:
  mov   rax, %%name
  cmp   rdi, rax
  jne    %%next
  mov  [rel %1], rsi
%endmacro

